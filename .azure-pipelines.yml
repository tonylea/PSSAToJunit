name: $(BuildDefinitionName)_$(date:yyyyMMdd)_$(rev:.r)

trigger:
  branches:
    include: ["main"]

pr:
  autoCancel: false
  branches:
    include: ["*"]

variables:
  - template: ./.ci/pipeline-variables.yml

stages:
  # Linting
  - template: ./.ci/stage-static-analysis.yml
    parameters:
      srcFolder: $(srcFolder)
      testResultsPath: $(testResultsPath)
      vmImage: $(vmLinuxImage)
      megaLinterFlavour: $(megaLinterFlavour)
      megaLinterVersion: $(megaLinterVersion)
      secretlintVersion: $(secretlintVersion)

  # Unit Tests
  - template: ./.ci/stage-unit-tests.yml
    parameters:
      buildFolder: $(buildFolder)
      # srcFolder: $(srcFolder)
      testResultsPath: $(testResultsPath)
      vmLinuxImage: $(vmLinuxImage)
      # vmWindowsImage: $(vmWindowsImage)
      # vmMacosImage: $(vmMacosImage)

  # Integration Tests
    # Import
    # Test outputs with pester
  # Build
    # Version bump
    # Minify and Package
    # Artifact
  # Publish
